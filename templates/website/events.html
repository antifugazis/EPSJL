{% extends "base.html" %}
{% block content %}
<section id="actualites" class="py-20 bg-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
       <div class="text-center">
          <h2 class="text-base font-semibold uppercase tracking-wide text-[#00AEEF]">Actualités</h2>
          <p class="mt-2 text-3xl font-bold tracking-tight text-black sm:text-4xl">Toute l'actualité de l'école</p>
          <p class="mx-auto mt-5 max-w-prose text-lg text-gray-600">Restez informé des événements, annonces et activités à l'École Presbytérale Saint Joseph de L'Asile.</p>
       </div>
       <!-- Search and filters -->
       <div class="mt-10">
          <div class="flex flex-col md:flex-row justify-between items-center mb-8">
             <div class="w-full md:w-1/2 mb-4 md:mb-0">
                <div class="relative">
                   <input type="text" id="search-input" placeholder="Rechercher par titre..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00AEEF]">
                   <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                         <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                      </svg>
                   </div>
                </div>
             </div>
             <div class="w-full md:w-auto flex flex-wrap justify-center gap-2">
                <button class="filter-btn active px-3 py-1 text-sm rounded-full bg-[#00AEEF] text-white" data-filter="all">Tous <span class="count">(4)</span></button>
                <button class="filter-btn px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300" data-filter="recent">Ajoutés récemment</button>
                <button class="filter-btn px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300" data-filter="upcoming">À venir</button>
                <button class="filter-btn px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300" data-filter="past">Passés</button>
             </div>
          </div>
          
          <!-- Category filters -->
          <div class="flex flex-wrap justify-center gap-2 mb-8">
             <button class="category-btn px-3 py-1 text-xs rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300" data-category="vie-scolaire">Vie scolaire <span class="count">(1)</span></button>
             <button class="category-btn px-3 py-1 text-xs rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300" data-category="annonces">Annonces officielles <span class="count">(1)</span></button>
             <button class="category-btn px-3 py-1 text-xs rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300" data-category="culture">Culture et foi <span class="count">(1)</span></button>
             <button class="category-btn px-3 py-1 text-xs rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300" data-category="celebrations">Célébrations religieuses <span class="count">(1)</span></button>
          </div>
       </div>
       
       <div class="mt-8">
          <div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3" data-aos="fade-up" data-aos-delay="200">
             {% if articles %}
                {% for article in articles %}
                <div class="card flex flex-col overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm hover:shadow-md transition-all duration-300" data-category="{{ article.categorie }}" data-date="{{ article.date_evenement.strftime('%Y-%m-%d') if article.date_evenement else article.date_creation.strftime('%Y-%m-%d') }}">
                   <div class="relative overflow-hidden h-48">
                      {% if article.image_couverture %}
                      <img src="/{{ article.image_couverture }}" alt="{{ article.titre }}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-105">
                      {% else %}
                      <img src="https://images.unsplash.com/photo-1523050854058-8df90110c9f1?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="{{ article.titre }}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-105">
                      {% endif %}
                      <div class="absolute top-0 right-0 mt-2 mr-2">
                         <span class="px-2 py-1 text-xs font-semibold rounded-full 
                            {% if article.categorie == 'vie-scolaire' %}bg-blue-100 text-blue-800
                            {% elif article.categorie == 'annonces' %}bg-green-100 text-green-800
                            {% elif article.categorie == 'culture' %}bg-yellow-100 text-yellow-800
                            {% elif article.categorie == 'celebrations' %}bg-purple-100 text-purple-800
                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                            {% if article.categorie == 'vie-scolaire' %}Vie scolaire
                            {% elif article.categorie == 'annonces' %}Annonces officielles
                            {% elif article.categorie == 'culture' %}Culture et foi
                            {% elif article.categorie == 'celebrations' %}Célébrations religieuses
                            {% else %}{{ article.categorie }}{% endif %}
                         </span>
                      </div>
                   </div>
                   <div class="flex-1 p-6">
                      <h3 class="text-lg font-bold text-black hover:text-[#00AEEF] transition-colors">{{ article.titre }}</h3>
                      <div class="mt-2 flex items-center text-sm text-gray-500">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar mr-1.5 h-4 w-4 text-[#00AEEF]">
                            <path d="M8 2v4"></path>
                            <path d="M16 2v4"></path>
                            <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                            <path d="M3 10h18"></path>
                         </svg>
                         {{ article.date_evenement.strftime('%d %B %Y') if article.date_evenement else article.date_creation.strftime('%d %B %Y') }}
                      </div>
                      <p class="mt-3 text-gray-600 line-clamp-3">{{ article.description_courte or article.contenu[:150] }}</p>
                      <div class="mt-4">
                         <a href="{{ url_for('articles.details', slug=article.slug) }}" class="inline-flex items-center text-sm font-medium text-[#00AEEF] hover:text-[#0098d1]">
                            En savoir plus
                            <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                         </a>
                      </div>
                   </div>
                </div>
                {% endfor %}
             {% else %}
                <div class="col-span-3 text-center py-12">
                   <p class="text-gray-500">Aucune actualité disponible pour le moment.</p>
                </div>
             {% endif %}
          </div>
       </div>
       
    </div>
 </section>
{% endblock %}

{% block scripts %}
<script>
   document.addEventListener('DOMContentLoaded', function() {
      // Get all filter buttons
      const filterBtns = document.querySelectorAll('.filter-btn');
      const categoryBtns = document.querySelectorAll('.category-btn');
      const searchInput = document.getElementById('search-input');
      const cards = document.querySelectorAll('.card');
      
      // Current active filters
      let activeFilter = 'all';
      let activeCategory = null;
      let searchTerm = '';
      
      // Filter cards based on current criteria
      function filterCards() {
         cards.forEach(card => {
            const cardCategory = card.dataset.category;
            const cardDate = card.dataset.date;
            const cardFilter = card.dataset.filter;
            const cardTitle = card.querySelector('h3').textContent.toLowerCase();
            
            // Check if card matches all active filters
            const matchesFilter = activeFilter === 'all' || cardFilter === activeFilter;
            const matchesCategory = !activeCategory || cardCategory === activeCategory;
            const matchesSearch = !searchTerm || cardTitle.includes(searchTerm);
            
            // Show/hide card based on filter matches
            if (matchesFilter && matchesCategory && matchesSearch) {
               card.style.display = 'flex';
            } else {
               card.style.display = 'none';
            }
         });
      }
      
      // Handle filter button clicks
      filterBtns.forEach(btn => {
         btn.addEventListener('click', function() {
            // Remove active class from all filter buttons
            filterBtns.forEach(b => b.classList.remove('active', 'bg-[#00AEEF]', 'text-white'));
            filterBtns.forEach(b => b.classList.add('bg-gray-200', 'text-gray-700'));
            
            // Add active class to clicked button
            this.classList.add('active', 'bg-[#00AEEF]', 'text-white');
            this.classList.remove('bg-gray-200', 'text-gray-700');
            
            // Update active filter
            activeFilter = this.dataset.filter;
            
            // Apply filters
            filterCards();
         });
      });
      
      // Handle category button clicks
      categoryBtns.forEach(btn => {
         btn.addEventListener('click', function() {
            // If already active, deactivate
            if (this.classList.contains('active')) {
               this.classList.remove('active', 'bg-[#00AEEF]', 'text-white');
               this.classList.add('bg-gray-200', 'text-gray-700');
               activeCategory = null;
            } else {
               // Remove active class from all category buttons
               categoryBtns.forEach(b => b.classList.remove('active', 'bg-[#00AEEF]', 'text-white'));
               categoryBtns.forEach(b => b.classList.add('bg-gray-200', 'text-gray-700'));
               
               // Add active class to clicked button
               this.classList.add('active', 'bg-[#00AEEF]', 'text-white');
               this.classList.remove('bg-gray-200', 'text-gray-700');
               
               // Update active category
               activeCategory = this.dataset.category;
            }
            
            // Apply filters
            filterCards();
         });
      });
      
      // Handle search input
      searchInput.addEventListener('input', function() {
         searchTerm = this.value.toLowerCase().trim();
         filterCards();
      });
      
      // Initialize with default filters
      filterCards();
   });
</script>
{% endblock %}